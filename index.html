<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>ğŸ„ è–èª•ç¨®è˜¿è”” 2025 ğŸ¥•</title>
<style>
/* ---------- åŸºæœ¬æ¨£å¼ ---------- */
body{
  margin:0;
  font-family:"Nunito",sans-serif;
  text-align:center;
  overflow-x:hidden;
  background:linear-gradient(#b3e5ff,#fff);
  position:relative;
}
.snow{
  position:fixed;
  top:-10px;
  color:white;
  animation:fall linear infinite;
  z-index:2000;
  pointer-events:none;
}
@keyframes fall{to{transform:translateY(110vh);}}
#music-control{
  position:fixed;top:10px;right:10px;width:46px;height:46px;border-radius:50%;
  background:rgba(255,255,255,0.85);display:flex;justify-content:center;align-items:center;
  font-size:22px;cursor:pointer;box-shadow:0 0 8px rgba(0,0,0,0.3);z-index:2100;
}
/* ---------- é–å± ---------- */
#lockscreen{
  margin:60px auto;width:90%;max-width:420px;padding:25px;background:rgba(255,255,255,0.9);
  border-radius:15px;box-shadow:0 0 10px rgba(0,0,0,0.1);position:relative;z-index:1000;
}
#countdown{font-size:18px;color:#055;margin-bottom:10px;font-weight:bold;}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:10px;}
.day{background:#fff;border-radius:6px;padding:6px;font-size:14px;box-shadow:0 0 3px rgba(0,0,0,0.2);}
.day.checked{background:#90ee90;font-weight:bold;color:#064;}
.daylabel{grid-column:span 7;text-align:left;font-size:16px;font-weight:bold;margin-top:4px;color:#333;}
input[type=password]{padding:10px;width:80%;border-radius:8px;border:1.8px solid #88c;}
button{padding:10px 14px;margin:6px 5px;border:none;border-radius:8px;background:#ff9999;color:white;font-size:16px;cursor:pointer;}
button:hover{filter:brightness(1.08);}
button:disabled{opacity:0.5;cursor:not-allowed;}
/* ---------- éŠæˆ²ä¸»ç•«é¢ ---------- */
#game{display:none;position:relative;z-index:1000;}
#merryTitle{
  display:none;
  position:absolute;
  top:0;
  left:50%;
  transform:translateX(-50%);
  width:100%;
  font-size:2em;
  font-weight:bold;
  color:#ff5b5b;
  text-shadow:0 0 12px rgba(255,120,120,0.7);
  z-index:100;
  animation:xmasFloatIn 1.2s ease-out forwards,
           xmasGlow 2.5s ease-in-out infinite alternate;
}
@keyframes xmasFloatIn{
  from{opacity:0;transform:translate(-50%,-12px) scale(0.96);}
  to  {opacity:1;transform:translate(-50%,0) scale(1);}
}
@keyframes xmasGlow{
  from{ text-shadow:0 0 8px rgba(255,120,120,0.4); }
  to  { text-shadow:0 0 18px rgba(255,40,40,0.85); }
}
.container{
  max-width:520px;margin:10px auto;background:rgba(255,255,255,0.95);border-radius:15px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);padding:15px;position:relative;
}
.value{font-size:18px;margin:4px 0;}
#field{
  position:relative;width:100%;height:200px;border-radius:10px;overflow:hidden;margin-top:10px;
  transition:background 1s;z-index:1;
}
.ground{
  position:absolute;bottom:0;width:100%;height:60%;
  background:repeating-linear-gradient(45deg,#784,#693 12px);
}
.plant{position:absolute;transition:all .5s ease;font-size:2em;opacity:0;}
.plant.show{opacity:1;}
.icon{position:absolute;font-size:2em;opacity:0;}
#rabbit,#cat{bottom:40px;}
#rabbit.run{animation:rabbit 4s linear;}
#cat.run{animation:cat 4s linear;}
@keyframes rabbit{0%{right:-50px;opacity:1;}100%{right:110%;opacity:0;}}
@keyframes cat{0%{left:110%;opacity:1;}100%{left:-50px;opacity:0;}}
.controls{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin-top:10px;}
.controls button{flex:1 1 45%;min-width:110px;}
@media(max-width:420px){.controls button{flex:1 1 100%;width:90%;}}
#rule-box{
  background:#eef;padding:8px;border-radius:8px;margin-top:6px;font-size:15px;
  line-height:1.4;display:none;text-align:left;
}
#toggle-rule{
  background:#88aaff;border:none;border-radius:8px;padding:6px 12px;color:#fff;font-weight:bold;
  cursor:pointer;margin-top:6px;
}
#eventBox{margin-top:8px;min-height:24px;font-weight:bold;color:#333;}
.bible-text{color:#c33;font-weight:bold;animation:shine 1s ease-in-out infinite alternate;}
@keyframes shine{0%{color:#c33;}100%{color:#f66;}}
/* ---------- å¤©æ°£ & ç‰¹æ•ˆ ---------- */
.star{position:absolute;width:2px;height:2px;background:white;border-radius:50%;animation:twinkle 2s infinite ease-in-out;}
@keyframes twinkle{0%,100%{opacity:0.5;}50%{opacity:1;}}
.meteor{
  position:absolute;width:100px;height:2px;
  background:linear-gradient(90deg,white,rgba(255,255,255,0));
  transform:rotate(45deg);animation:shootLeft 3s linear;
}
@keyframes shootLeft{
  0%{right:-100px;top:-20px;opacity:0;}
  10%{opacity:1;}
  100%{right:110%;top:100%;opacity:0;}
}
.bird{position:absolute;top:20px;left:-50px;font-size:1.6em;animation:birdfly 4s linear;}
@keyframes birdfly{0%{left:-50px;opacity:1;}100%{left:110%;opacity:0;}}
.sun{position:absolute;top:10px;right:10px;font-size:2em;animation:shineSun 2s ease-in-out infinite alternate;}
@keyframes shineSun{from{filter:brightness(1);}to{filter:brightness(1.5);}}
.snowflake{position:absolute;color:white;animation:dropSnow 4s linear;}
@keyframes dropSnow{0%{top:-10px;opacity:1;}100%{top:100%;opacity:0;}}
.rain{position:absolute;color:#00f;animation:dropRain 2s linear;}
@keyframes dropRain{0%{top:-10px;opacity:1;}100%{top:100%;opacity:0;}}
.flash{animation:flashRed 0.2s alternate 10;}
@keyframes flashRed{from{filter:brightness(1);}to{filter:brightness(1.5) sepia(1) hue-rotate(-20deg);}}
/* ---------- è–èª• Popup ---------- */
#xmasPopupOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2500;
}
#xmasPopup{
  position:relative;
  width:min(420px,90vw);
  background:linear-gradient(145deg,#ffffff,#f7fbff);
  border-radius:18px;
  padding:22px 22px 20px;
  box-shadow:0 12px 30px rgba(0,0,0,0.18);
  animation:xmasPopupIn .45s ease-out;
  overflow:hidden;
}
#xmasPopupClose{
  position:absolute;
  top:10px;
  right:10px;
  border:none;
  background:rgba(255,255,255,0.9);
  width:26px;
  height:26px;
  border-radius:999px;
  cursor:pointer;
  font-size:15px;
  line-height:1;
  box-shadow:0 0 6px rgba(0,0,0,0.15);
}
.xmas-popup-header{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  margin-bottom:10px;
}
.xmas-title{
  font-size:20px;
  font-weight:700;
  color:#ff5b5b;
  text-shadow:0 0 10px rgba(255,150,150,0.6);
}
.xmas-emoji{font-size:24px;}
.xmas-popup-body{
  text-align:center;
  color:#333;
}
.xmas-main-text{
  margin:0 0 14px;
  line-height:1.6;
  font-size:15px;
}
.xmas-money{
  font-weight:700;
  color:#e53935;
}
.xmas-pics{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:6px 0 12px;
}
.xmas-pic-card{
  background:rgba(255,255,255,0.9);
  border-radius:12px;
  padding:6px 8px 5px;
  box-shadow:0 3px 8px rgba(0,0,0,0.08);
  min-width:70px;
}
.xmas-pic-icon{font-size:26px;}
.xmas-pic-label{
  font-size:11px;
  margin-top:2px;
}
.xmas-snow-row{
  display:flex;
  justify-content:center;
  gap:12px;
  font-size:18px;
  opacity:0.8;
}
@keyframes xmasPopupIn{
  from{opacity:0;transform:translateY(20px) scale(0.96);}
  to  {opacity:1;transform:translateY(0) scale(1);}
}

/* ---------- éš¨æ©Ÿäº‹ä»¶ Popup ---------- */
#eventPopupOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2600;
}
#eventPopup{
  width:min(400px,90vw);
  background:#ffffff;
  border-radius:14px;
  padding:16px 18px 14px;
  box-shadow:0 10px 25px rgba(0,0,0,0.25);
  text-align:center;
}
#eventPopupEmoji{
  font-size:30px;
  margin-bottom:6px;
}
#eventPopupTitle{
  font-size:18px;
  font-weight:bold;
  margin-bottom:6px;
}
#eventPopupText{
  font-size:14px;
  line-height:1.5;
  color:#333;
}
#eventPopupHint{
  font-size:12px;
  color:#777;
  margin-top:8px;
}

/* ---------- è–èª•ç¦®å“æ›è³¼ Popup ---------- */
#giftShopOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2550;
}
#giftShop{
  width:min(420px,92vw);
  max-height:90vh;
  background:#ffffff;
  border-radius:16px;
  padding:16px 18px 14px;
  box-shadow:0 10px 25px rgba(0,0,0,0.25);
  text-align:left;
  overflow-y:auto;
}
#giftShop h2{
  text-align:center;
  margin:4px 0 8px;
}
#giftShop .bp-line{
  text-align:center;
  margin-bottom:10px;
  font-size:15px;
}
.gift-list{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.gift-item{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  padding:8px 10px;
  border-radius:10px;
  background:#f5f7ff;
  font-size:14px;
}
.gift-left{
  display:flex;
  align-items:flex-start;
  gap:8px;
}
.gift-icon{font-size:22px;margin-top:2px;}
.gift-name{font-weight:600;}
.gift-cost{font-size:12px;color:#555;margin-top:2px;}
.gift-effect{font-size:12px;color:#444;margin-top:2px;line-height:1.4;}
.gift-item button{
  padding:6px 10px;
  font-size:13px;
  border-radius:999px;
  background:#ff9999;
  white-space:nowrap;
}
.gift-item button.claimed{
  background:#9ccc65;
}
#closeGiftShop{
  display:block;
  margin:10px auto 4px;
  background:#888;
  font-size:14px;
  padding:6px 14px;
}

/* ---------- è–èª•é”æ¨™ç‡ Progress ---------- */
#xmasProgress{
  margin-top:6px;
}
#xmasProgressLabel{
  font-size:14px;
  margin-bottom:4px;
}
.xmasProgressOuter{
  width:90%;
  height:14px;
  margin:0 auto 4px;
  border-radius:999px;
  background:#e0e0e0;
  overflow:hidden;
}
#xmasProgressBarFill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#ffb74d,#f4511e);
  transition:width 0.4s ease;
  border-radius:999px;
}

/* ---------- ğŸ è–èª•ç¦®ç‰©å±•ç¤º Frame ---------- */
#xmasOwnedFrame{
  margin-top:8px;
  padding:10px 10px 12px;
  border-radius:16px;
  background:#ffeef1;
  border:1px solid #b9404a;
  box-shadow:0 2px 6px rgba(185,64,74,0.22);
  text-align:center;
}
.xmasOwnedTitle{
  font-weight:bold;
  color:#b9404a;
  margin-bottom:2px;
}
#xmasOwnedList{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
  min-height:26px;
  margin-top:6px;
}
.xmasGiftIcon{
  width:32px;
  height:32px;
  border-radius:50%;
  background:#ffffff;
  border:2px solid #b9404a;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:19px;
  cursor:pointer;
  position:relative;
  box-shadow:0 1px 3px rgba(0,0,0,0.16);
  transition:transform 0.12s ease, box-shadow 0.12s ease;
}
.xmasGiftIcon:hover{
  transform:translateY(-1px) scale(1.05);
  box-shadow:0 3px 7px rgba(0,0,0,0.22);
}

/* ğŸ Gift Tooltip */
#xmasGiftTooltip{
  position:fixed;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.35);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
#xmasGiftTooltip .tooltipInner{
  max-width:280px;
  width:80%;
  background:#fff;
  border-radius:16px;
  padding:14px 16px 12px;
  box-shadow:0 4px 14px rgba(0,0,0,0.25);
  text-align:center;
}
#xmasGiftTooltip .tooltipIcon{
  font-size:32px;
  margin-bottom:6px;
}
#xmasGiftTooltip .tooltipName{
  font-weight:bold;
  margin-bottom:4px;
  color:#b9404a;
}
#xmasGiftTooltip .tooltipEffect{
  font-size:13px;
  color:#555;
  margin-bottom:10px;
  line-height:1.5;
}
#xmasGiftTooltip button{
  padding:6px 14px;
  border:none;
  border-radius:999px;
  background:#b9404a;
  color:#fff;
  font-size:13px;
  cursor:pointer;
}
</style>
</head>
<body>
<script>
for(let i=0;i<25;i++){
  let s=document.createElement('div');
  s.className='snow';s.textContent='â„ï¸';
  s.style.left=Math.random()*100+'%';
  s.style.fontSize=(10+Math.random()*10)+'px';
  s.style.animationDuration=(5+Math.random()*5)+'s';
  document.body.appendChild(s);
}
</script>

<div id="music-control">ğŸ”Š</div>

<audio id="bgm-normal" loop preload="auto">
  <source src="bells.mp3" type="audio/mpeg">
</audio>
<audio id="bgm-xmas" loop preload="auto">
  <source src="1224.mp3" type="audio/mpeg">
</audio>

<!-- è–èª• Popup -->
<div id="xmasPopupOverlay">
  <div id="xmasPopup">
    <button id="xmasPopupClose">âœ•</button>
    <div class="xmas-popup-header">
      <span class="xmas-emoji">ğŸ…</span>
      <span class="xmas-title">MERRY CHRISTMAS</span>
      <span class="xmas-emoji">ğŸ</span>
    </div>
    <div class="xmas-popup-body">
      <p class="xmas-main-text">
        è–èª•å¿«æ¨‚!! ğŸ„<br>
        è¦ªæ„›çš„å°å…”å­ ğŸ°<br>
        å¸Œæœ›ä½  enjoy æˆ‘ç‚ºä½ æº–å‚™å˜…
        <span class="xmas-money">ğŸ’µ 100 èšŠè–èª•ç¦®ç‰©</span> !!!
      </p>
      <div class="xmas-pics">
        <div class="xmas-pic-card">
          <div class="xmas-pic-icon">ğŸ°</div>
          <div class="xmas-pic-label">å°å…”å­</div>
        </div>
        <div class="xmas-pic-card">
          <div class="xmas-pic-icon">ğŸ„</div>
          <div class="xmas-pic-label">è–èª•æ¨¹</div>
        </div>
        <div class="xmas-pic-card">
          <div class="xmas-pic-icon">ğŸ</div>
          <div class="xmas-pic-label">ç¦®ç‰©ç›’</div>
        </div>
      </div>
      <div class="xmas-snow-row">
        <span>â„ï¸</span><span>â„ï¸</span><span>â„ï¸</span>
      </div>
    </div>
  </div>
</div>

<!-- éš¨æ©Ÿäº‹ä»¶ Popup -->
<div id="eventPopupOverlay">
  <div id="eventPopup">
    <div id="eventPopupEmoji">âœ¨</div>
    <div id="eventPopupTitle">äº‹ä»¶ç™¼ç”Ÿäº†ï¼</div>
    <div id="eventPopupText">â€¦â€¦</div>
    <div id="eventPopupHint">ï¼ˆé»æ“Šç•«é¢ä»»ä½•åœ°æ–¹é—œé–‰ï¼‰</div>
  </div>
</div>

<!-- è–èª•ç¦®å“ Popup -->
<div id="giftShopOverlay">
  <div id="giftShop">
    <h2>ğŸ è–èª•ç¦®å“æ›è³¼</h2>
    <div class="bp-line">ğŸ¥• èƒŒåŒ…ï¼š<span id="bpCountInShop">0</span> æ ¹</div>
    <div class="gift-list" id="giftList"></div>
    <button id="closeGiftShop">é—œé–‰</button>
  </div>
</div>

<!-- é»æ“Šç¦®ç‰© icon Tooltip -->
<div id="xmasGiftTooltip">
  <div class="tooltipInner">
    <div class="tooltipIcon" id="tooltipIcon"></div>
    <div class="tooltipName" id="tooltipName"></div>
    <div class="tooltipEffect" id="tooltipEffect"></div>
    <button id="closeGiftTooltip">é—œé–‰</button>
  </div>
</div>

<!-- é–å± -->
<div id="lockscreen">
 <h2>ğŸ„ è–èª•ç¨®è˜¿è””ç‰¹åˆ¥æ´»å‹• ğŸ¥•</h2>
 <div id="countdown">è¼‰å…¥ä¸­...</div>
 <div class="daylabel">ğŸ°ğŸ„ è–èª•æ‰“å¡æ—¥æ›†ï¼ˆ12æœˆ1â€“24ï¼‰</div>
 <div id="calendar" class="calendar"></div>
 <p>è«‹è¼¸å…¥éŠ€è¡Œå’­å¯†ç¢¼ï¼š</p>
 <input type="password" id="pwd" placeholder="è¼¸å…¥å¯†ç¢¼"><br>
 <button id="loginBtn">ç™»å…¥</button>
 <p id="msg" style="color:red;"></p>
</div>

<!-- éŠæˆ² -->
<div id="game">
 <div id="merryTitle">ğŸ…â€¯MERRYâ€¯CHRISTMASâ€¯ğŸ</div>
 <div class="container">
  <h3>ğŸ°ğŸ„ğŸ¥•ğŸ¥• ç¨®è˜¿è””â€¯ğŸ„</h3>
  <div class="value" id="lastLoginText">ä¸Šä¸€æ¬¡ç™»å…¥ï¼š--</div>
  <div class="value" id="wild">ç¨®æ¤ä¸­ğŸ¥•ï¼š0</div>
  <div class="value" id="safe">éŠ€è¡Œå„²å€¼ğŸ’³ï¼š0</div>
  <div class="value" id="backpack">ğŸ¥• èƒŒåŒ…ï¼š0</div>
  <div class="value" id="total">ğŸ¥•ğŸ¥•ç¸½æ”¶æˆï¼š0æ ¹</div>

  <!-- 1ï¸âƒ£ è–èª•é”æ¨™ç‡ BAR -->
  <div id="xmasProgress">
    <div id="xmasProgressLabel">
      ğŸ’³ æ›è–èª•ç¦®é”æ¨™ç‡ï¼š<span id="xmasProgressText">0/1888</span>
    </div>
    <div class="xmasProgressOuter">
      <div id="xmasProgressBarFill"></div>
    </div>
  </div>

  <!-- 2ï¸âƒ£ å·²æ›åˆ°çš„è–èª•ç¦®ç‰© Frame -->
  <div id="xmasOwnedFrame">
    <div class="xmasOwnedTitle">ğŸ„ æ›åˆ°çš„è–èª•ç¦®ç‰© ğŸ</div>
    <div id="xmasOwnedList"></div>
  </div>

  <div id="field">
    <div class="ground"></div>
    <div class="icon" id="rabbit">ğŸ‡</div>
    <div class="icon" id="cat">ğŸˆ</div>
  </div>
  <div class="controls">
   <button id="plantBtn">ç¨®è˜¿è”” ğŸŒ° (20/20)</button>
   <button id="waterBtn">æ·‹æ°´ ğŸ’§ (1/1)</button>
   <button id="bankBtn">å­˜å…¥éŠ€è¡Œ ğŸ’³</button>
   <button id="toBackpackBtn" style="background:#ffb74d;">ğŸ¥• æ”¾å…¥èƒŒåŒ…</button>
   <button id="exchangeGiftBtn" style="background:#ab47bc;">ğŸ æ›è³¼è–èª•ç¦®å“</button>
   <button id="setBackpackTestBtn" style="background:#00897b;">ğŸ§ª è¨­å®šèƒŒåŒ…è˜¿è””</button>
   <button id="resetBtn" style="background:#77bb77;">ğŸ”„â€¯é‡æ–°é–‹å§‹</button>
   <button id="testBtn" style="background:#59c;">ğŸ„â€¯è–èª•æ¸¬è©¦</button>
   <button id="growTestBtn" style="background:#ffaa00;">ğŸ§ªâ€¯ä¸‹ä¸€éšæ®µæ¸¬è©¦</button>
  </div>
  <button id="toggle-rule">ğŸŒ±â€¯ç¨®æ¤è¦å‰‡</button>
  <div id="rule-box">
    ğŸŒ± <b>ç¨®æ¤è¦å‰‡ï¼š</b><br>
    1ï¸âƒ£ æ¯æ¬¡æŒ‰ã€Œç¨®è˜¿è””ã€æœƒç¨®å‡ºä¸€æ£µæ–°è˜¿è””ã€‚<br>
    2ï¸âƒ£ ä¸Šé¢é¡¯ç¤º <b>(ç›®å‰æ•¸é‡ / æœ€å¤§ 20)</b>ï¼Œç”¨å®Œ 20 ç²’ä¹‹å¾Œï¼Œè¦ç­‰æ™‚é–“è‡ªå‹•å›å¾©ã€‚<br>
    3ï¸âƒ£ ç¨®å­æœƒç¶“éä¸‰å€‹éšæ®µï¼š<br>
    &nbsp;&nbsp;&nbsp;â€¢ ğŸŒ° ç¨®å­ï¼ˆå‰›ç¨®è½å»ï¼‰<br>
    &nbsp;&nbsp;&nbsp;â€¢ ğŸŒ¿ å¹¼è‹—ï¼ˆå¤§ç´„ 1.5 å°æ™‚å¾Œï¼‰<br>
    &nbsp;&nbsp;&nbsp;â€¢ ğŸ¥• æˆç†Ÿè˜¿è””ï¼ˆå¤§ç´„ 3 å°æ™‚å¾Œï¼Œç¸½å…±ï¼‰<br>
    4ï¸âƒ£ ã€Œæ·‹æ°´ ğŸ’§ã€æ¯æ—¥é™æŒ‰ä¸€æ¬¡ï¼Œæœƒä¸€æ¬¡éæ·‹æ™’æ‰€æœ‰ç•¶æ™‚å­˜åœ¨çš„è˜¿è””ï¼š<br>
    &nbsp;&nbsp;&nbsp;â€¢ å–º ğŸŒ° éšæ®µè¢«æ·‹éæ°´ï¼šæ°´è¨˜éŒ„å–ºã€Œç¨®å­ã€<br>
    &nbsp;&nbsp;&nbsp;â€¢ å–º ğŸŒ¿ éšæ®µè¢«æ·‹éæ°´ï¼šæ°´è¨˜éŒ„å–ºã€Œå¹¼è‹—ã€<br>
    5ï¸âƒ£ æ”¶æˆè«‹ç”¨ã€Œå­˜å…¥éŠ€è¡Œ ğŸ’³ã€ï¼Œåªæœƒæ”¶æˆå·²ç¶“ä¿‚ ğŸ¥• çš„è˜¿è””ï¼Œæ•¸é‡è¨ˆæ³•ï¼š<br>
    &nbsp;&nbsp;&nbsp;â€¢ æœªæ·‹éæ°´ï¼š+1 æ ¹<br>
    &nbsp;&nbsp;&nbsp;â€¢ åªå–ºä¸€å€‹éšæ®µæ·‹éæ°´ï¼ˆç¨®å­ æˆ– å¹¼è‹—ï¼‰ï¼š+3 æ ¹<br>
    &nbsp;&nbsp;&nbsp;â€¢ ç¨®å­åŒå¹¼è‹—å…©å€‹éšæ®µéƒ½æ·‹éæ°´ï¼š+5 æ ¹<br>
    6ï¸âƒ£ æ”¶æˆå¾Œå˜…è˜¿è””æœƒåŠ åˆ°ã€ŒéŠ€è¡Œå„²å€¼ ğŸ’³ã€ï¼ŒåŒæ™‚è¨ˆå…¥ã€Œç¸½æ”¶æˆã€ã€‚<br>
    7ï¸âƒ£ ç‰¹åˆ¥äº‹ä»¶ï¼ˆå°é³¥ã€å¤ªé™½ã€è½é›ªã€å°è²“ã€å°å…”ï¼‰æœƒä¸å®šæ™‚å‡ºç¾ï¼Œ<br>
    &nbsp;&nbsp;&nbsp;æœ‰å•²æœƒåŠ è˜¿è””ï¼Œæœ‰å•²æœƒå·èµ°ï¼æ¸›å°‘è˜¿è””ï¼Œè«‹å°å¿ƒå®ˆè­·ä½ å˜…ç”°ï¼<br>
    8ï¸âƒ£ 12 æœˆ 24 æ—¥ï¼ˆæˆ–é–‹å•Ÿè–èª•æ¸¬è©¦æ¨¡å¼ï¼‰æ™‚ï¼š<br>
    &nbsp;&nbsp;&nbsp;â€¢ ç”°è£¡æ‰€æœ‰è˜¿è””æœƒè®Šæˆ ğŸ„ è–èª•æ¨¹ / ğŸ ç¦®ç‰©ï¼Œ<br>
    &nbsp;&nbsp;&nbsp;â€¢ æœƒå½ˆå‡ºè–èª•ç¥ç¦è¦–çª—ï¼Œè¨˜å¾—å»éŠ€è¡Œç‡ä½ å˜…ç¦®ç‰©ï½<br>
  </div>
  <div id="eventBox">ğŸŒ¤â€¯æ­¡è¿å›ä¾†ï¼Œå°è¾²å¤«ï½</div>
 </div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const PASSWORD="600lovefafa";

  const CHECKIN_KEY_NEW="checkin2025";
  const CHECKIN_KEY_OLD="adventCheckin2025";

  const OLD_GAME_KEY="carrotGame2025";
  const GAME_SAVE_KEY="carrotGame2025_v2";
  const LAST_LOGIN_KEY="carrotLastLogin";

  const XMAS_TARGET_CARROTS = 1888;

  const XMAS_GIFTS = [
    { id:"hat_rabbit",  name:"ğŸ… å…”å…”è–èª•å¸½",   icon:"ğŸ…", cost:200, type:"decor",
      effect:"ç´”è£é£¾é™å®šå°ç‰©ï¼Œä»£è¡¨ä½ å·²æ­£å¼æˆç‚ºä»Šå¹´å˜…è–èª•å°è¾²å¤«ï½" },
    { id:"rabbit_box",  name:"ğŸ å…”å…”é©šå–œç¦®ç›’", icon:"ğŸ", cost:400, type:"buff",
      effect:"æ¯æ¬¡æ”¶æˆæˆ–æ”¾å…¥èƒŒåŒ…æ™‚ï¼Œæœ‰ 20% æ©Ÿæœƒé¡å¤– +1 æ ¹è˜¿è””æ”¾å…¥èƒŒåŒ…ã€‚" },
    { id:"tree_cat",    name:"ğŸ„ è²“è²“è–èª•æ¨¹",   icon:"ğŸ„", cost:600, type:"buff",
      effect:"ä»¤æ‰€æœ‰è˜¿è””æˆé•·æ™‚é–“ç¸®çŸ­ç´„ 10%ï¼Œæ›´å¿«ç”±ç¨®å­è®Šæˆæˆç†Ÿè˜¿è””ã€‚" },
    { id:"cat_heater",  name:"ğŸ•¯ï¸ è²“è²“æš–çˆ",   icon:"ğŸ•¯ï¸", cost:500, type:"buff",
      effect:"é‡åˆ°è½é›ªäº‹ä»¶æ™‚æœ‰ 50% æ©Ÿæœƒå®Œå…¨å…ç–«æå¤±ï¼Œä¿è­·ä½ å˜…è˜¿è””ä¸è¢«é›ªåŸ‹ã€‚" },
    { id:"cat_cookie",  name:"ğŸª è–èª•è²“è–„é¤…", icon:"ğŸª", cost:700, type:"buff",
      effect:"å°è²“åŸæœ¬æœƒå·é£Ÿè˜¿è””æ™‚ï¼Œæœ‰ 50% æ©Ÿæœƒè®Šæˆå¹«ä½ æ·‹æ°´å˜…å¥½è²“è²“ã€‚" },
    { id:"star_lights", name:"â­ å…”è²“æµæ˜Ÿç‡ˆ", icon:"â­", cost:900, type:"buff_decor",
      effect:"ä¹‹å¾Œæ¯æ¬¡ç¨®è˜¿è””ï¼Œæœ‰ 5% æ©Ÿæœƒé¡å¤–è§¸ç™¼ä¸€å€‹éš¨æ©Ÿå¥½äº‹äº‹ä»¶ï¼ˆåŠ è˜¿è””/å¹«å¿™ï¼‰ã€‚" }
  ];

  const cal=document.getElementById("calendar");

  function loadCheckin(){
    let raw=localStorage.getItem(CHECKIN_KEY_NEW);
    let fromOld=false;
    if(!raw){
      raw=localStorage.getItem(CHECKIN_KEY_OLD);
      if(raw) fromOld=true;
    }
    let days=[];
    try{
      days=raw?JSON.parse(raw):[];
      if(!Array.isArray(days)) days=[];
    }catch(e){days=[];}
    if(fromOld){
      localStorage.setItem(CHECKIN_KEY_NEW,JSON.stringify(days));
    }
    return days;
  }
  let data=loadCheckin();

  const countdownEl=document.getElementById("countdown");
  function updateCountdown(){
    const now=new Date();
    const target=new Date(now.getFullYear(),11,24,0,0,0,0);
    const diff=target-now;
    if(diff<=0){
      countdownEl.textContent="ğŸ‰ ä»Šæ—¥å°±ä¿‚å¹³å®‰å¤œ / è–èª•å•¦ï¼";
      return;
    }
    const d=Math.floor(diff/86400000);
    const h=Math.floor(diff%86400000/3600000);
    countdownEl.textContent=`è·é›¢ 12 æœˆ 24 æ—¥ä»²æœ‰ ${d} æ—¥ ${h} å°æ™‚`;
  }
  updateCountdown();
  setInterval(updateCountdown,60000);

  const bgmNormal=document.getElementById("bgm-normal");
  const bgmXmas=document.getElementById("bgm-xmas");
  const musicBtn=document.getElementById("music-control");
  let currentBgm=bgmNormal;
  let musicOn=false;

  let globalXmasTest=false;
  function setGlobalXmasTest(v){ globalXmasTest=v; }

  function isXmasDay(){
    const now=new Date();
    return now.getMonth()===11 && now.getDate()===24;
  }
  function shouldUseXmasMusic(){
    return isXmasDay() || globalXmasTest;
  }
  function chooseBgm(){
    currentBgm.pause();
    currentBgm.currentTime=0;
    currentBgm = shouldUseXmasMusic() ? bgmXmas : bgmNormal;
  }
  function tryPlayBgm(auto=false){
    currentBgm.volume=0.8;
    currentBgm.play()
      .then(()=>{
        musicOn=true;
        musicBtn.textContent="ğŸ”ˆ";
      })
      .catch(()=>{
        if(!auto){
          musicOn=false;
          musicBtn.textContent="ğŸ”Š";
        }
      });
  }
  chooseBgm();
  tryPlayBgm(true);

  for(let i=1;i<=24;i++){
    const d=document.createElement("div");
    d.className="day";d.textContent=i;
    if(data.includes(i)) d.classList.add("checked");
    cal.appendChild(d);
  }

  function formatDateStr(date){
    const y=date.getFullYear();
    const m=String(date.getMonth()+1).padStart(2,"0");
    const d=String(date.getDate()).padStart(2,"0");
    const hh=String(date.getHours()).padStart(2,"0");
    const mm=String(date.getMinutes()).padStart(2,"0");
    return `${y}-${m}-${d} ${hh}:${mm}`;
  }

  document.getElementById("loginBtn").onclick=()=>{
    const pwd=document.getElementById("pwd").value.trim();
    if(pwd!==PASSWORD){
      document.getElementById("msg").textContent="âŒâ€¯å¯†ç¢¼éŒ¯èª¤";
      return;
    }
    const now=new Date();
    if(now.getMonth()==11 && now.getDate()<=24){
      const day=now.getDate();
      if(!data.includes(day)){
        data.push(day);
        localStorage.setItem(CHECKIN_KEY_NEW,JSON.stringify(data));
      }
    }

    const prevLogin=localStorage.getItem(LAST_LOGIN_KEY);
    if(prevLogin){
      setTimeout(()=>{
        const t=document.getElementById("lastLoginText");
        if(t) t.textContent="ä¸Šä¸€æ¬¡ç™»å…¥ï¼š"+prevLogin;
      },0);
    }else{
      setTimeout(()=>{
        const t=document.getElementById("lastLoginText");
        if(t) t.textContent="ä¸Šä¸€æ¬¡ç™»å…¥ï¼šç¬¬ä¸€æ¬¡ç™»å…¥ ğŸ‰";
      },0);
    }
    localStorage.setItem(LAST_LOGIN_KEY,formatDateStr(now));

    document.getElementById("lockscreen").style.display="none";
    document.getElementById("game").style.display="block";

    chooseBgm();
    tryPlayBgm(false);

    initGame();
  };

  function initGame(){
    const PLANT_MAX=20;
    const PLANT_REGEN_INTERVAL=5*60*1000;

    let seeds=[];
    let safeCarrot=0;
    let bankStored=0;
    let plantLimit=PLANT_MAX;
    let waterLimit=1;
    let plantRegenStart=null;
    let xmasTest=false;
    let dailyEvents=0;

    let backpackCarrot=0;
    let items={};
    let totalCarrotCollected=0;

    let loginEventTimer=null;

    const field=document.getElementById("field");
    const eventBox=document.getElementById("eventBox");
    const wildEl=document.getElementById("wild");
    const safeEl=document.getElementById("safe");
    const backpackEl=document.getElementById("backpack");
    const totalEl=document.getElementById("total");
    const merryTitle=document.getElementById("merryTitle");
    const xmasPopupOverlay=document.getElementById("xmasPopupOverlay");
    const xmasPopupClose=document.getElementById("xmasPopupClose");

    const eventPopupOverlay=document.getElementById("eventPopupOverlay");
    const eventPopupEmoji=document.getElementById("eventPopupEmoji");
    const eventPopupTitle=document.getElementById("eventPopupTitle");
    const eventPopupText=document.getElementById("eventPopupText");

    const giftShopOverlay=document.getElementById("giftShopOverlay");
    const giftListEl=document.getElementById("giftList");
    const bpCountInShopEl=document.getElementById("bpCountInShop");
    const closeGiftShopBtn=document.getElementById("closeGiftShop");

    const xmasProgressText=document.getElementById("xmasProgressText");
    const xmasProgressBarFill=document.getElementById("xmasProgressBarFill");

    const xmasOwnedList=document.getElementById("xmasOwnedList");
    const xmasGiftTooltip=document.getElementById("xmasGiftTooltip");
    const tooltipIcon=document.getElementById("tooltipIcon");
    const tooltipName=document.getElementById("tooltipName");
    const tooltipEffect=document.getElementById("tooltipEffect");
    const closeGiftTooltipBtn=document.getElementById("closeGiftTooltip");

    let eventQueue=[];
    let showingEventPopup=false;

    function showEventPopup(emoji,title,text,finalText){
      eventQueue.push({emoji,title,text,finalText});
      if(!showingEventPopup){
        displayNextEventPopup();
      }
    }
    function displayNextEventPopup(){
      const ev=eventQueue.shift();
      if(!ev){
        showingEventPopup=false;
        return;
      }
      showingEventPopup=true;
      eventPopupEmoji.textContent=ev.emoji;
      eventPopupTitle.textContent=ev.title;
      eventPopupText.textContent=ev.text;
      eventPopupOverlay.style.display="flex";

      const closeHandler=()=>{
        eventPopupOverlay.style.display="none";
        eventPopupOverlay.removeEventListener("click",closeHandler);
        eventBox.textContent=ev.finalText;
        showingEventPopup=false;
        displayNextEventPopup();
      };
      eventPopupOverlay.addEventListener("click",closeHandler);
    }

    function setXmasUI(show){
      if(show){
        merryTitle.style.display="block";
        xmasPopupOverlay.style.display="flex";
      }else{
        merryTitle.style.display="none";
        xmasPopupOverlay.style.display="none";
      }
    }
    const today=new Date();
    const isRealXmasEve=(today.getMonth()===11 && today.getDate()===24);
    if(isRealXmasEve) setXmasUI(true); else setXmasUI(false);
    xmasPopupClose.addEventListener("click",()=>{xmasPopupOverlay.style.display="none";});

    document.getElementById("toggle-rule").onclick=()=>{
      const box=document.getElementById("rule-box");
      box.style.display=(box.style.display==="none"||!box.style.display)?"block":"none";
    };

    function random(min,max){return Math.random()*(max-min)+min;}
    function hasItem(id){return !!items[id];}

    function updateFieldStyle(forceNormal=false){
      const now=new Date();
      const hour=now.getHours();
      const isRealXmas=(now.getMonth()==11 && now.getDate()==24);
      const isXmas=(!forceNormal)&&(isRealXmas||xmasTest);

      field.querySelectorAll('.star,.meteor').forEach(e=>e.remove());

      if(isXmas){
        field.style.background="linear-gradient(#001633 0%, #223355 40%, #eef5ff 40%, #eef5ff 100%)";
        field.querySelector(".ground").style.background=
          "repeating-linear-gradient(45deg,#ccd,#eef 12px)";
        for(let i=0;i<40;i++){
          let st=document.createElement("div");
          st.className="star";
          st.style.left=Math.random()*100+"%";
          st.style.top=Math.random()*40+"%";
          st.style.animationDelay=(Math.random()*2)+"s";
          field.appendChild(st);
        }
        if(Math.random()<0.4){
          let m=document.createElement("div");
          m.className="meteor";
          field.appendChild(m);
          setTimeout(()=>m.remove(),3000);
        }
      }else if(hour>=6 && hour<18){
        field.style.background="linear-gradient(#aee7ff 0%, #aee7ff 40%, #8be25d 40%, #8be25d 100%)";
        field.querySelector(".ground").style.background=
          "repeating-linear-gradient(45deg,#784,#693 12px)";
      }else{
        field.style.background="linear-gradient(#001233 0%, #223355 40%, #274a27 40%, #274a27 100%)";
        field.querySelector(".ground").style.background=
          "repeating-linear-gradient(45deg,#384,#274 12px)";
        for(let i=0;i<20;i++){
          const st=document.createElement("div");
          st.className="star";
          st.style.left=Math.random()*100+"%";
          st.style.top=Math.random()*30+"%";
          field.appendChild(st);
        }
      }
    }

    function getDisplayProgress(){
      const now=new Date();
      const isAfterXmasEve = (now.getMonth()===11 && now.getDate()>=24);
      let current = totalCarrotCollected;
      const target = XMAS_TARGET_CARROTS;
      if(isAfterXmasEve){
        current = target;
      }
      return {current, target};
    }

    function updateXmasProgressUI(){
      const {current, target} = getDisplayProgress();
      xmasProgressText.textContent = `${current}/${target}`;
      const pct = Math.min(100, (current/target)*100);
      xmasProgressBarFill.style.width = pct + "%";
    }

    function renderOwnedGifts(){
      xmasOwnedList.innerHTML = "";
      XMAS_GIFTS.forEach(g=>{
        if(items && items[g.id]){
          const div=document.createElement("div");
          div.className="xmasGiftIcon";
          div.textContent=g.icon || "ğŸ";
          div.title=g.name;
          div.addEventListener("click",()=>openGiftTooltip(g));
          xmasOwnedList.appendChild(div);
        }
      });
      if(xmasOwnedList.children.length===0){
        const span=document.createElement("span");
        span.style.fontSize="13px";
        span.style.color="#999";
        span.textContent="æš«æ™‚ä»²æœªæ›åˆ°ç¦®ç‰©ï¼ŒåŠªåŠ›ç¨®å¤šå•²è˜¿è””å•¦ï½";
        xmasOwnedList.appendChild(span);
      }
    }

    function openGiftTooltip(gift){
      tooltipIcon.textContent = gift.icon || "ğŸ";
      tooltipName.textContent = gift.name;
      tooltipEffect.textContent = gift.effect;
      xmasGiftTooltip.style.display = "flex";
    }
    closeGiftTooltipBtn.addEventListener("click",()=>{
      xmasGiftTooltip.style.display="none";
    });
    xmasGiftTooltip.addEventListener("click",(e)=>{
      if(e.target===xmasGiftTooltip){
        xmasGiftTooltip.style.display="none";
      }
    });

    function updateUI(){
      const growing=seeds.filter(p=>p.stage!=="grown").length;
      const total=growing+safeCarrot;
      wildEl.textContent="ç¨®æ¤ä¸­ğŸ¥•ï¼š"+growing;
      safeEl.textContent="éŠ€è¡Œå„²å€¼ğŸ’³ï¼š"+safeCarrot;
      backpackEl.textContent="ğŸ¥• èƒŒåŒ…ï¼š"+backpackCarrot;
      totalEl.textContent="ç¸½æ”¶æˆï¼š"+total+"æ ¹";
      document.getElementById("plantBtn").textContent=`ç¨®è˜¿è”” ğŸŒ° (${plantLimit}/${PLANT_MAX})`;
      document.getElementById("waterBtn").textContent=`æ·‹æ°´ ğŸ’§ (${waterLimit}/1)`;
      updateXmasProgressUI();
      renderOwnedGifts();
    }

    function updatePlantRegen(){
      if(plantRegenStart==null) return;
      if(plantLimit>=PLANT_MAX){
        plantRegenStart=null;
        return;
      }
      const now=Date.now();
      const elapsed=now-plantRegenStart;
      if(elapsed<PLANT_REGEN_INTERVAL) return;
      const canRegen=Math.floor(elapsed/PLANT_REGEN_INTERVAL);
      if(canRegen<=0) return;
      const old=plantLimit;
      const next=Math.min(plantLimit+canRegen,PLANT_MAX);
      plantLimit=next;
      if(plantLimit>=PLANT_MAX){
        plantRegenStart=null;
      }else{
        const used=next-old;
        plantRegenStart+=used*PLANT_REGEN_INTERVAL;
      }
      updateUI();
      saveGame();
    }

    function saveGame(){
      const simpleSeeds=seeds.map(p=>({
        stage:p.stage,
        wateredSeed:p.wateredSeed,
        wateredSprout:p.wateredSprout,
        plantedAt:p.plantedAt,
        left:p.el.style.left,
        bottom:p.el.style.bottom
      }));
      const data={
        seeds:simpleSeeds,
        safeCarrot,
        bankStored,
        plantLimit,
        waterLimit,
        plantRegenStart,
        xmasTest,
        backpackCarrot,
        items,
        totalCarrotCollected
      };
      localStorage.setItem(GAME_SAVE_KEY,JSON.stringify(data));
    }

    function loadGame(){
      let raw=localStorage.getItem(GAME_SAVE_KEY);
      let fromOld=false;
      if(!raw){
        raw=localStorage.getItem(OLD_GAME_KEY);
        if(raw) fromOld=true;
      }
      if(!raw) return;
      try{
        const data=JSON.parse(raw);
        safeCarrot=data.safeCarrot??0;
        bankStored=data.bankStored??0;
        plantLimit=data.plantLimit??PLANT_MAX;
        waterLimit=data.waterLimit??1;
        plantRegenStart=data.plantRegenStart??null;
        xmasTest=data.xmasTest??false;
        backpackCarrot=data.backpackCarrot??0;
        items=data.items || {};
        totalCarrotCollected=data.totalCarrotCollected ?? 0;
        setGlobalXmasTest(xmasTest);

        seeds=(data.seeds||[]).map(p=>{
          const el=document.createElement("div");
          el.className="plant show";
          el.style.left=p.left || (Math.random()*80+10)+"%";
          el.style.bottom=p.bottom || (Math.random()*15+25)+"%";
          el.textContent="ğŸŒ°";
          field.appendChild(el);
          return{
            stage:p.stage || "seed",
            wateredSeed:!!p.wateredSeed,
            wateredSprout:!!p.wateredSprout,
            plantedAt:p.plantedAt || Date.now(),
            el
          };
        });

        recomputeGrowth(true);
        if(xmasTest){
          seeds.forEach(p=>p.el.textContent="ğŸ„");
          setXmasUI(true);
        }
        if(fromOld){
          saveGame();
        }
      }catch(e){
        console.error("Load game failed:",e);
      }
    }

    // 1.5 å°æ™‚ + 1.5 å°æ™‚ æˆé•·
    function recomputeGrowth(init=false){
      const now = Date.now();
      const ONE_AND_HALF_HOUR = 1.5 * 60 * 60;

      let baseSeedToSprout = ONE_AND_HALF_HOUR;
      let baseSeedToGrown  = ONE_AND_HALF_HOUR * 2;

      if (hasItem("tree_cat")) {
        baseSeedToSprout *= 0.9;
        baseSeedToGrown  *= 0.9;
      }

      let changed=false;
      seeds.forEach(p=>{
        const elapsedSec=(now-p.plantedAt)/1000;

        let newStage="seed";
        if (elapsedSec >= baseSeedToGrown)        newStage="grown";
        else if (elapsedSec >= baseSeedToSprout)  newStage="sprout";

        if(newStage!==p.stage || init){
          p.stage=newStage;
          if(newStage==="seed")       p.el.textContent="ğŸŒ°";
          else if(newStage==="sprout")p.el.textContent="ğŸŒ¿";
          else if(newStage==="grown") p.el.textContent="ğŸ¥•";
          changed=true;
        }
      });
      if(changed && !init) saveGame();
      updateUI();
    }

    function checkXmasAuto(){
      const date=new Date();
      if(date.getMonth()==11 && date.getDate()==24 && !xmasTest){
        seeds.forEach(p=>p.el.textContent="ğŸ„");
        eventBox.textContent="ğŸ„â€¯è–èª•ç¯€åˆ°ï¼æ‰€æœ‰è˜¿è””è®Šæˆè–èª•æ¨¹ï¼";
        updateFieldStyle();
        setXmasUI(true);
        saveGame();
      }
    }

    function triggerPositiveEvent(){
      const positive = [sunEvent, rainEvent, catWater, rabbitHelp];
      const fn = positive[Math.floor(Math.random()*positive.length)];
      fn();
    }
    function triggerEvent(){
      const r=Math.random();
      if(r<0.15)      birdEvent();
      else if(r<0.3)  sunEvent();
      else if(r<0.4)  lavaEvent();
      else if(r<0.5)  snowEvent();
      else if(r<0.6)  rainEvent();
      else if(r<0.7)  catSteal();
      else if(r<0.8)  catWater();
      else if(r<0.9)  rabbitHelp();
      else            rabbitEat();
    }
    function scheduleLoginEvent(){
      if(loginEventTimer) clearTimeout(loginEventTimer);
      if(seeds.length===0) return;
      loginEventTimer = setTimeout(()=>{
        if(seeds.length>0 && Math.random() < 0.8){
          triggerEvent();
        }
        loginEventTimer=null;
      }, 2*60*1000);
    }

    function renderGiftList(){
      giftListEl.innerHTML = "";
      XMAS_GIFTS.forEach(g=>{
        const itemDiv=document.createElement("div");
        itemDiv.className="gift-item";
        const leftDiv=document.createElement("div");
        leftDiv.className="gift-left";

        const iconSpan=document.createElement("span");
        iconSpan.className="gift-icon";
        iconSpan.textContent=g.icon;

        const textWrap=document.createElement("div");
        const nameDiv=document.createElement("div");
        nameDiv.className="gift-name";
        nameDiv.textContent=g.name;
        const costDiv=document.createElement("div");
        costDiv.className="gift-cost";
        costDiv.textContent=`éœ€è¦ ğŸ¥•${g.cost} æ ¹`;
        const effectDiv=document.createElement("div");
        effectDiv.className="gift-effect";
        effectDiv.textContent=g.effect;

        textWrap.appendChild(nameDiv);
        textWrap.appendChild(costDiv);
        textWrap.appendChild(effectDiv);
        leftDiv.appendChild(iconSpan);
        leftDiv.appendChild(textWrap);

        const btn=document.createElement("button");
        if(hasItem(g.id)){
          btn.textContent="å·²æ›é ˜";
          btn.classList.add("claimed");
          btn.disabled=true;
        }else{
          btn.textContent="æ›é ˜";
        }

        btn.addEventListener("click",()=>{
          if(hasItem(g.id)) return;
          if(backpackCarrot < g.cost){
            eventBox.textContent="ğŸ¥• èƒŒåŒ…è˜¿è””å””å¤ ï¼Œç¨®å¤šå•²å…ˆå•¦ï½";
            return;
          }
          backpackCarrot -= g.cost;
          items[g.id] = true;
          eventBox.textContent=`å·²æ›é ˜ï¼š${g.name}ï¼`;
          updateUI();
          saveGame();
          bpCountInShopEl.textContent = backpackCarrot;
          renderGiftList();
        });

        itemDiv.appendChild(leftDiv);
        itemDiv.appendChild(btn);
        giftListEl.appendChild(itemDiv);
      });
    }

    function openGiftShop(){
      bpCountInShopEl.textContent = backpackCarrot;
      renderGiftList();
      giftShopOverlay.style.display="flex";
    }
    function closeGiftShop(){
      giftShopOverlay.style.display="none";
    }
    closeGiftShopBtn.addEventListener("click", closeGiftShop);
    giftShopOverlay.addEventListener("click",(e)=>{
      if(e.target===giftShopOverlay) closeGiftShop();
    });

    loadGame();
    updateFieldStyle(true);
    updatePlantRegen();
    updateUI();
    scheduleLoginEvent();

    document.getElementById("plantBtn").onclick=()=>{
      if(plantLimit<=0){
        eventBox.textContent="ğŸŒ° ç¨®å­ç”¨å®Œäº†ï¼Œç­‰ä¸€ç­‰æœƒè‡ªå‹•å›å¾©ï½";
        return;
      }
      plantLimit--;
      if(plantLimit===0 && plantRegenStart==null){
        plantRegenStart=Date.now();
      }
      const el=document.createElement("div");
      el.className="plant show";el.textContent="ğŸŒ°";
      el.style.left=random(5,85)+"%";
      el.style.bottom=random(25,40)+"%";
      field.appendChild(el);
      seeds.push({
        stage:"seed",
        wateredSeed:false,
        wateredSprout:false,
        plantedAt:Date.now(),
        el
      });
      eventBox.textContent="ğŸŒ±â€¯æ–°è˜¿è””ç¨®ä¸‹ï½";

      if(hasItem("star_lights") && Math.random() < 0.05){
        triggerPositiveEvent();
      }

      updateUI();
      saveGame();
      scheduleLoginEvent();
    };

    document.getElementById("waterBtn").onclick=()=>{
      if(waterLimit<=0)return;
      waterLimit--;
      seeds.forEach(p=>{
        if(p.stage==="seed") p.wateredSeed=true;
        else if(p.stage==="sprout") p.wateredSprout=true;
      });
      eventBox.textContent="ğŸ’§â€¯æ·‹æ°´å®Œæˆï¼";
      updateUI();
      saveGame();
    };

    document.getElementById("bankBtn").onclick=()=>{
      const today=new Date();
      const isXmas=(today.getMonth()==11 && today.getDate()==24)||xmasTest;
      if(isXmas){
        eventBox.innerHTML="<span class='bible-text'>ğŸâ€¯è–èª•å¿«æ¨‚ï¼å»éŠ€è¡Œçœ‹ç¦®ç‰©ï½</span>";
        return;
      }
      let harvested=0;
      seeds=seeds.filter(p=>{
        if(p.stage==="grown"){
          let add=1;
          if(p.wateredSeed&&p.wateredSprout) add=5;
          else if(p.wateredSeed||p.wateredSprout) add=3;
          harvested+=add;
          setTimeout(()=>p.el.remove(),500);
          return false;
        }
        return true;
      });
      if(harvested>0){
        safeCarrot+=harvested;
        bankStored+=harvested;
        totalCarrotCollected += harvested;

        if(hasItem("rabbit_box") && Math.random()<0.2){
          backpackCarrot += 1;
          totalCarrotCollected += 1;
          eventBox.textContent=`ğŸ’³â€¯æ”¶æˆâ€¯${harvested}â€¯æ ¹ï¼Œå­˜å…¥éŠ€è¡Œï¼ç¦®ç›’åŠ é€ 1 æ ¹å…¥èƒŒåŒ…ï½`;
        }else{
          eventBox.textContent=`ğŸ’³â€¯æ”¶æˆâ€¯${harvested}â€¯æ ¹ï¼Œå­˜å…¥éŠ€è¡Œï¼`;
        }
      }else{
        eventBox.textContent="å†‡æˆç†Ÿè˜¿è””ï½";
      }
      updateUI();
      saveGame();
      scheduleLoginEvent();
    };

    document.getElementById("toBackpackBtn").onclick=()=>{
      let harvested=0;
      seeds = seeds.filter(p=>{
        if(p.stage==="grown"){
          let add=1;
          if(p.wateredSeed&&p.wateredSprout) add=5;
          else if(p.wateredSeed||p.wateredSprout) add=3;
          harvested+=add;
          setTimeout(()=>p.el.remove(),500);
          return false;
        }
        return true;
      });

      if(harvested<=0){
        eventBox.textContent="æš«æ™‚å†‡å¯ä»¥æ”¶æˆå˜…è˜¿è””ï½";
        return;
      }

      backpackCarrot += harvested;
      totalCarrotCollected += harvested;

      if(hasItem("rabbit_box") && Math.random()<0.2){
        backpackCarrot += 1;
        totalCarrotCollected += 1;
        eventBox.textContent=`ğŸ¥• å·²å°‡ ${harvested} æ ¹è˜¿è””æ”¾å…¥èƒŒåŒ…ï¼ç¦®ç›’é¡å¤–é€ 1 æ ¹ï½`;
      }else{
        eventBox.textContent=`ğŸ¥• å·²å°‡ ${harvested} æ ¹è˜¿è””æ”¾å…¥èƒŒåŒ…ï¼`;
      }

      updateUI();
      saveGame();
      scheduleLoginEvent();
    };

    document.getElementById("exchangeGiftBtn").onclick=()=>{
      openGiftShop();
    };

    document.getElementById("setBackpackTestBtn").onclick=()=>{
      const v = prompt("è¼¸å…¥èƒŒåŒ…è˜¿è””æ•¸é‡ï¼ˆåªåšæ¸¬è©¦ç”¨ï¼‰ï¼š", backpackCarrot);
      if(v===null) return;
      const n = parseInt(v,10);
      if(isNaN(n) || n<0){
        alert("è«‹è¼¸å…¥ 0 æˆ–ä»¥ä¸Šå˜…æ•´æ•¸ã€‚");
        return;
      }
      backpackCarrot = n;
      eventBox.textContent="ğŸ§ª å·²æ›´æ–°èƒŒåŒ…è˜¿è””æ•¸é‡ï¼ˆæ¸¬è©¦æ¨¡å¼ï¼‰ã€‚";
      updateUI();
      saveGame();
    };

    document.getElementById("resetBtn").onclick=()=>{
      if(confirm("ç¢ºå®šè¦é‡è¨­ï¼Ÿï¼ˆåŒ…æ‹¬æ¸…é™¤æœ¬æ©Ÿç´€éŒ„ï¼‰")){
        localStorage.removeItem(GAME_SAVE_KEY);
        localStorage.removeItem(OLD_GAME_KEY);
        localStorage.removeItem(CHECKIN_KEY_NEW);
        localStorage.removeItem(CHECKIN_KEY_OLD);
        localStorage.removeItem(LAST_LOGIN_KEY);
        location.reload();
      }
    };

    document.getElementById("testBtn").onclick=()=>{
      xmasTest=!xmasTest;
      setGlobalXmasTest(xmasTest);
      const now=new Date();
      const isRealXmas=(now.getMonth()==11 && now.getDate()==24);
      const isXmasMode=isRealXmas||xmasTest;
      if(isXmasMode){
        seeds.forEach(p=>p.el.textContent="ğŸ„");
        eventBox.textContent="ğŸ§ª å·²é–‹å•Ÿè–èª•æ¸¬è©¦æ¨¡å¼ï¼Œè˜¿è””è®Šæˆè–èª•æ¨¹ï½";
        setXmasUI(true);
      }else{
        recomputeGrowth(true);
        eventBox.textContent="ğŸ§ª å·²é—œé–‰è–èª•æ¸¬è©¦æ¨¡å¼ï½";
        if(!isRealXmas) setXmasUI(false);
      }
      updateFieldStyle();
      saveGame();
      chooseBgm();
      if(musicOn) tryPlayBgm(false);
    };

    document.getElementById("growTestBtn").onclick=()=>{
      seeds.forEach(p=>{
        if(p.stage==="seed"){p.stage="sprout";p.el.textContent="ğŸŒ¿";}
        else if(p.stage==="sprout"){p.stage="grown";p.el.textContent="ğŸ¥•";}
      });
      eventBox.textContent="ğŸ§ªâ€¯æ‰€æœ‰æ¤ç‰©å‰é€²ä¸€å€‹éšæ®µ";
      saveGame();
      updateUI();
    };

    setInterval(()=>{
      checkXmasAuto();
      const date=new Date();
      const isXmas=(date.getMonth()==11 && date.getDate()==24)||xmasTest;
      if(isXmas){
        seeds.forEach(p=>p.el.textContent="ğŸ„");
        updateFieldStyle();
        return;
      }
      recomputeGrowth(false);
      updateFieldStyle();
    },60000);

    setInterval(()=>{updatePlantRegen();},10000);

    setInterval(()=>{
      if(dailyEvents>=2) return;
      if(Math.random()<0.3){
        dailyEvents++;
        triggerEvent();
      }
    },45000);

    function birdEvent(){
      if(seeds.length>0) seeds.pop();
      const b=document.createElement("div");
      b.className="bird";b.textContent="ğŸ¦";
      field.appendChild(b);
      setTimeout(()=>b.remove(),4000);
      updateUI();saveGame();
      showEventPopup("ğŸ¦","å°é³¥åšŸå’—ï¼","ä¸€éš»å°é³¥é£›éåšŸï¼Œå·å’—ä½ ä¸€æ£µè˜¿è””ã€‚","ğŸ¦â€¯å°é³¥åƒæ‰è˜¿è””â€¯-1");
    }

    function sunEvent(){
      const s=document.createElement("div");
      s.className="sun";s.textContent="â˜€ï¸";
      field.appendChild(s);
      safeCarrot+=2;
      totalCarrotCollected += 2;
      setTimeout(()=>s.remove(),4000);
      updateUI();saveGame();
      showEventPopup("â˜€ï¸","é™½å…‰æ™®ç…§ï¼","ä»Šæ—¥é™½å…‰å¥½éšï¼Œè˜¿è””é•·å¾—ç‰¹åˆ¥å¥½ï¼Œå¤šå’—å…©æ ¹ï¼","â˜€ï¸â€¯é™½å…‰æ™®ç…§â€¯+2â€¯è˜¿è””");
    }

    function lavaEvent(){
      const grownIndices = seeds
        .map((p,i)=>p.stage==="grown" ? i : -1)
        .filter(i=>i!==-1);

      if(grownIndices.length===0){
        seeds.forEach(p=>p.el.remove());
        seeds=[];
      }else{
        const keepIndex = grownIndices[Math.floor(Math.random()*grownIndices.length)];
        seeds.forEach((p,i)=>{
          if(i===keepIndex){
            p.stage="grown";
            p.el.textContent="ğŸ¥•";
          }else{
            p.el.remove();
          }
        });
        seeds = [seeds[keepIndex]];
      }

      document.body.classList.add("flash");
      setTimeout(()=>document.body.classList.remove("flash"),10000);

      updateUI();saveGame();
      showEventPopup("ğŸŒ‹","ç†”å²©è­¦å ±ï¼","ç†”å²©ç¶“éï¼ŒæŠŠå¤§éƒ¨åˆ†è˜¿è””åŒç¨®å­éƒ½ç‡’èµ°ï¼Œåªå‰©è¿”ä¸€æ£µï¼","ğŸŒ‹â€¯ç†”å²©ç‡’äº†è˜¿è””ï¼Œåªå‰©ä¸€æ£µï¼");
    }

    function snowEvent(){
      if(hasItem("cat_heater") && Math.random()<0.5){
        showEventPopup("ğŸ•¯ï¸","è²“è²“æš–çˆç™¼åŠŸï¼","æœ¬ä¾†è¦è½é›ªå‚·å®³è˜¿è””ï¼Œä½†æœ‰è²“è²“æš–çˆå¹«ä½ æ“‹ä½ï¼Œä»Šæ¬¡å†‡æå¤±ï½","ğŸ•¯ï¸â€¯æš–çˆä¿è­·ï¼Œé›ªç½å…ç–«ï¼");
        return;
      }
      if(seeds.length>0) seeds.pop();
      for(let i=0;i<15;i++){
        const s=document.createElement("div");
        s.className="snowflake";s.textContent="â„ï¸";
        s.style.left=Math.random()*100+"%";
        field.appendChild(s);
        setTimeout(()=>s.remove(),4000);
      }
      updateUI();saveGame();
      showEventPopup("â„ï¸","ä¸‹é›ªäº†ï¼","å¤©æ°£çªç„¶è®Šå†·ï¼Œä¸‹èµ·é›ªåšŸï¼Œæœ‰ä¸€æ£µè˜¿è””è¢«é›ªåŸ‹å’—ã€‚","â„ï¸â€¯ä¸‹é›ªâ€¯è˜¿è””â€¯-1");
    }

    function rainEvent(){
      safeCarrot+=2;
      totalCarrotCollected += 2;
      for(let i=0;i<20;i++){
        const r=document.createElement("div");
        r.className="rain";r.textContent="ğŸ’§";
        r.style.left=Math.random()*100+"%";
        field.appendChild(r);
        setTimeout(()=>r.remove(),2000);
      }
      updateUI();saveGame();
      showEventPopup("ğŸ’§","è½é›¨å¥½æ¶ˆæ¯ï¼","ä¸€å ´æº«æŸ”å˜…é›¨æ»‹æ½¤å’—ç”°è£¡æ‰€æœ‰è˜¿è””ï¼Œå¤šå’—å…©æ ¹ï¼","ğŸ’§â€¯è½é›¨â€¯è˜¿è””â€¯+2");
    }

    function catSteal(){
      if(hasItem("cat_cookie") && Math.random()<0.5){
        catWater();
        return;
      }
      if(seeds.length>0) seeds.pop();
      const c=document.getElementById("cat");
      c.classList.add("run");
      setTimeout(()=>c.classList.remove("run"),4000);
      updateUI();saveGame();
      showEventPopup("ğŸˆ","å°è²“å·é£Ÿï¼","å°è²“å·å·èµ°å…¥ç”°è£¡ï¼Œå¼èµ°å’—ä¸€æ£µè˜¿è””ï¼Œå–µï½","ğŸˆâ€¯å°è²“å·èµ°è˜¿è””â€¯å–µï½");
    }

    function catWater(){
      safeCarrot+=1;
      totalCarrotCollected += 1;
      const drop=document.createElement("div");
      drop.className="rain";drop.textContent="ğŸ’§";
      drop.style.left="50%";drop.style.animationDuration="1s";
      field.appendChild(drop);
      setTimeout(()=>drop.remove(),1000);
      updateUI();saveGame();
      showEventPopup("ğŸ¾","å°è²“å¹«å¿™ï¼","å°è²“å¥½æœ‰æ„›å¿ƒï¼Œå¹«ä½ å–ºç”°ä¸­å¤®æ·‹å’—ä¸€å•²æ°´ï¼Œå¤šå’—ä¸€æ ¹è˜¿è””ã€‚","ğŸ¾â€¯å°è²“å¹«å¿™æ·‹æ°´â€¯+1");
    }

    function rabbitHelp(){
      safeCarrot+=1;
      totalCarrotCollected += 1;
      const r=document.getElementById("rabbit");
      r.classList.add("run");
      setTimeout(()=>r.classList.remove("run"),4000);
      updateUI();saveGame();
      showEventPopup("ğŸ‡","å°å…”å¹«æ‰‹ï¼","å°å…”ä¹–ä¹–å¹«ä½ é¬†åœŸï¼Œä»¤åœŸå£¤æ›´è‚¥æ²ƒï¼Œå¤šå’—ä¸€æ ¹è˜¿è””ã€‚","ğŸ‡â€¯å°å…”å¹«ç¿»åœ°â€¯+1");
    }

    function rabbitEat(){
      if(seeds.length>0) seeds.pop();
      const r=document.getElementById("rabbit");
      r.classList.add("run");
      setTimeout(()=>r.classList.remove("run"),4000);
      updateUI();saveGame();
      showEventPopup("ğŸ‡","å°å…”è²ªé£Ÿï¼","å°å…”å¤ªè‚šé¤“ï¼Œå¿å””ä½å’¬å’—ä½ ä¸€æ£µè˜¿è””ã€‚","ğŸ‡â€¯å°å…”å­è²ªé£Ÿâ€¯å’¬è˜¿è””ğŸ¥•â€¯");
    }
  }
});
</script>
</body>
</html>
