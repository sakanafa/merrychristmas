<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ğŸ„ è–èª•ç¨®è˜¿è”” ğŸ¥•</title>
<style>
body{
  margin:0;
  font-family:"Nunito",sans-serif;
  background:linear-gradient(#b4e4ff,#fff);
  text-align:center;
  overflow-x:hidden;
}
.snowflake{position:fixed;top:-10px;color:white;animation:fall linear infinite;z-index:5;}
@keyframes fall{to{transform:translateY(110vh);}}

#music-control{
 position:fixed;top:10px;right:10px;width:46px;height:46px;border-radius:50%;
 background:rgba(255,255,255,0.85);display:flex;justify-content:center;align-items:center;
 font-size:24px;cursor:pointer;box-shadow:0 0 8px rgba(0,0,0,0.3);z-index:100;
}
#music-control:hover{transform:scale(1.1);}

#lockscreen{
 position:relative;z-index:10;background:rgba(255,255,255,0.95);
 border-radius:15px;box-shadow:0 0 10px rgba(0,0,0,.1);
 margin:80px auto;padding:25px;width:90%;max-width:380px;text-align:center;
}
input[type=password]{padding:10px;width:80%;border-radius:8px;border:1.8px solid #88c;}
button{
 padding:10px 14px;margin:6px 5px;border:none;border-radius:8px;background:#ff9999;
 color:white;font-size:16px;cursor:pointer;transition:filter .2s;
}
button:hover{filter:brightness(1.08);}
button:disabled{opacity:0.5;cursor:not-allowed;}
#msg{color:red;height:1.2em;margin-top:6px;}

#game{display:none;}
.container{
 max-width:500px;margin:10px auto;background:rgba(255,255,255,0.9);
 border-radius:15px;box-shadow:0 0 10px rgba(0,0,0,0.1);
 padding:15px;
}
.value{font-size:18px;margin:4px 0;}
.progress-container{background:#eee;border-radius:10px;margin:8px auto;width:90%;height:16px;}
.progress-bar{background:linear-gradient(45deg,#ffcc00,#ffaa00);height:100%;width:0%;transition:width 0.4s ease;}

#field{position:relative;width:100%;height:200px;background:linear-gradient(#4ae,#3b9);border-radius:10px;overflow:hidden;margin-top:10px;}
@media (max-width:480px){#field{height:160px;}}
.ground{position:absolute;bottom:0;width:100%;height:60%;background:repeating-linear-gradient(45deg,#784,#693 12px);}
.plant{position:absolute;transition:all .5s ease;font-size:2em;opacity:0;transform:translateY(10px);}
.plant.show{opacity:1;transform:translateY(0);}
.icon{position:absolute;font-size:2em;opacity:0;}
#rabbit,#cat{bottom:40px;}
#rabbit.run{animation:rabbit 4s linear;}
#cat.run{animation:cat 4s linear;}
@keyframes rabbit{0%{left:-50px;opacity:1;}100%{left:110%;opacity:0;}}
@keyframes cat{0%{left:110%;opacity:1;}100%{left:-50px;opacity:0;}}

.controls{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin-top:10px;}
.controls button{flex:1 1 45%;min-width:130px;}
@media (max-width:420px){.controls button{flex:1 1 100%;width:90%;}}
#message{min-height:22px;margin-top:8px;}
#timer{margin-top:6px;font-weight:bold;color:#333;}
</style>
</head>
<body>

<!-- é£„é›ª -->
<script>
for(let i=0;i<35;i++){
 const s=document.createElement("div");
 s.className="snowflake";s.textContent="â„ï¸";
 s.style.left=Math.random()*100+"%";
 s.style.fontSize=(10+Math.random()*10)+"px";
 s.style.animationDuration=(5+Math.random()*5)+"s";
 document.body.appendChild(s);
}
</script>

<!-- éŸ³æ¨‚ -->
<div id="music-control">ğŸ”Š</div>
<audio id="bgm" loop preload="auto"><source src="bgm.mp3" type="audio/mpeg"></audio>

<!-- ç™»å…¥ -->
<div id="lockscreen">
 <h2>ğŸ„ è–èª•ç¨®è˜¿è”” ğŸ¥•</h2>
 <p id="welcomeText">è«‹è¼¸å…¥æ´»å‹•å¯†ç¢¼ ğŸ…</p>
 <input type="password" id="pwd" placeholder="è¼¸å…¥å¯†ç¢¼"><br>
 <button id="loginBtn">ç™»å…¥</button>
 <p id="msg"></p>
</div>

<!-- éŠæˆ² -->
<div id="game">
<div class="container">
  <h3>ğŸ‘©â€ğŸŒ¾ è–èª•ç¨®è˜¿è””ï¼ˆå¤šè˜¿è””ç”°ï¼‰ğŸŒ±</h3>
  <div class="value" id="wild">é‡ç”Ÿè˜¿è””ğŸ¥•ï¼š0</div>
  <div class="value" id="safe">å®‰å…¨è˜¿è””ğŸŒŸï¼š0</div>
  <div class="value" id="total">ç¸½æ”¶æˆï¼š0 æ ¹</div>
  <div class="value" id="rate">VIP å®‰å…¨ç‡ï¼š0%</div>
  <div class="progress-container"><div class="progress-bar" id="bar"></div></div>

  <div id="field"><div class="ground"></div><div class="icon" id="rabbit">ğŸ‡</div><div class="icon" id="cat">ğŸ±</div></div>

  <div class="controls">
    <button id="plantBtn">ç¨®è˜¿è”” ğŸŒ° (20/20)</button>
    <button id="waterBtn">æ·‹æ°´ ğŸ’§ (1/1)</button>
    <button id="bankBtn">å­˜å…¥éŠ€è¡Œ ğŸ’³</button>
    <button id="resetBtn" style="background:#77bb77;">ğŸ”„ é‡æ–°é–‹å§‹</button>
  </div>

  <div id="message"></div>
  <div id="timer"></div>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
// === éŸ³æ¨‚æ§åˆ¶ ===
const bgm=document.getElementById('bgm');
let playing=false;
document.getElementById('music-control').addEventListener("click",(e)=>{
 if(!playing){bgm.play();playing=true;e.target.textContent='ğŸ”ˆ';}
 else{bgm.pause();playing=false;e.target.textContent='ğŸ”‡';}
});

// === ç™»å…¥ ===
const PASSWORD="carrot2025";
document.getElementById("loginBtn").addEventListener("click",()=>{
 const val=document.getElementById("pwd").value.trim();
 if(val===PASSWORD){
   document.getElementById("lockscreen").style.display="none";
   document.getElementById("game").style.display="block";
   msg.textContent="ğŸ ç™»å…¥æˆåŠŸï¼é–‹å§‹ç¨®è˜¿è””å§ï¼";
   setTimeout(()=>msg.textContent="",3000);
 }else document.getElementById("msg").textContent="âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ ğŸ";
});

// === éŠæˆ²æ•¸æ“š ===
let seeds=[]; // å„æ£µè˜¿è”” {stage, wateredSeed, wateredSprout, el, start}
let safeCarrot=0;
let plantLimit=20;
let waterLimit=1;

const field=document.getElementById("field");
const msg=document.getElementById("message");
const bar=document.getElementById("bar");
const wildEl=document.getElementById("wild");
const safeEl=document.getElementById("safe");
const totalEl=document.getElementById("total");
const rateEl=document.getElementById("rate");
const timerText=document.getElementById("timer");
const plantBtn=document.getElementById("plantBtn");
const waterBtn=document.getElementById("waterBtn");

// === æ¯æ—¥é‡ç½® ===
function dailyReset(){
 const today=new Date().toDateString();
 const last=localStorage.getItem("lastReset");
 if(last!==today){
   localStorage.clear();
   plantLimit=20; waterLimit=1;
   localStorage.setItem("lastReset",today);
 }else{
   const p=localStorage.getItem("plantLimit");
   const w=localStorage.getItem("waterLimit");
   if(p)plantLimit=parseInt(p);
   if(w)waterLimit=parseInt(w);
 }
}
dailyReset();

// === ç¨®è˜¿è”” ===
plantBtn.addEventListener("click",()=>{
 if(plantLimit<=0){msg.textContent="ğŸš« ä»Šæ—¥ç¨®å®Œå–‡ï¼ç­‰è½æ—¥å†åšŸï½";return;}
 plantLimit--; localStorage.setItem("plantLimit",plantLimit);
 const el=document.createElement("div");
 el.className="plant show"; el.textContent="ğŸŒ°";
 el.style.left=Math.random()*80+5+"%";
 el.style.bottom=Math.random()*10+25+"%";
 field.appendChild(el);
 seeds.push({stage:"seed",wateredSeed:false,wateredSprout:false,start:Date.now(),el});
 msg.textContent="ğŸŒ± ç¨®ä¸‹è˜¿è””ç¨®å­ï¼ï¼ˆæœƒæ…¢æ…¢é•·å¤§ï¼‰";
 updateUI();
});

// === æ·‹æ°´ï¼ˆæ¯æ—¥ä¸€æ¬¡ï¼‰===
waterBtn.addEventListener("click",()=>{
 if(waterLimit<=0){msg.textContent="ğŸ’§ ä»Šæ—¥å·²ç¶“æ·‹éå–‡ï¼";return;}
 waterLimit--; localStorage.setItem("waterLimit",waterLimit);
 // æ‰¾å‡ºé‚„æ²’æˆç†Ÿçš„ä½œç‰©
 const candidates=seeds.filter(p=>p.stage!=="grown");
 if(candidates.length===0){msg.textContent="å†‡ç¨®å­ï¼å°è‹—å¯æ·‹ï½";return;}
 candidates.forEach(p=>{
   if(p.stage==="seed" && !p.wateredSeed){p.wateredSeed=true;}
   else if(p.stage==="sprout" && !p.wateredSprout){p.wateredSprout=true;}
 });
 msg.textContent="ğŸ’§ æˆåŠŸæ·‹æ°´ï¼ï¼ˆæœƒå½±éŸ¿æœªä¾†æ”¶æˆï¼‰";
 updateUI();
});

// === æˆé•·å¾ªç’° ===
setInterval(()=>{
 const now=Date.now();
 for(const p of seeds){
   const elapsed=(now-p.start)/1000;
   if(p.stage==="seed" && elapsed>=5400){ // 1.5h -> sprout
      p.stage="sprout";
      p.el.textContent="ğŸŒ¿";
   }else if(p.stage==="sprout" && elapsed>=10800){ // 3h -> grown
      p.stage="grown";
      p.el.textContent="ğŸ¥•";
   }
 }
 updateUI();
},60000); // æ¯åˆ†é˜æª¢æŸ¥

// === å­˜å…¥éŠ€è¡ŒæŒ‰éˆ• ===
document.getElementById("bankBtn").addEventListener("click",()=>{
 let harvested=0;
 seeds=seeds.filter(p=>{
   if(p.stage==="grown"){
     // åˆ¤æ–·åŠ æˆ
     let add=1;
     if(p.wateredSeed && p.wateredSprout) add=5;
     else if(p.wateredSeed || p.wateredSprout) add=3;
     else add=1;
     harvested+=add;
     p.el.textContent="âœ¨";
     setTimeout(()=>p.el.remove(),1500);
     return false; // ç§»é™¤é€™æ£µ
   }
   return true;
 });
 safeCarrot+=harvested;
 if(harvested>0) msg.textContent=`ğŸ’³ æ”¶æˆ ${harvested} æ ¹å®‰å…¨è˜¿è””ï¼Œå·²å­˜å…¥éŠ€è¡Œï¼`;
 else msg.textContent="å†‡æˆç†Ÿè˜¿è””å¯ä»¥æ”¶æˆï½";
 updateUI();
});

// === é‡ç½®éŠæˆ² ===
document.getElementById("resetBtn").addEventListener("click",()=>{
 if(confirm("ç¢ºå®šè¦é‡æ–°é–‹å§‹ï¼Ÿæœƒæ¸…é™¤æ‰€æœ‰é€²åº¦å–” ğŸŒ±")){
   localStorage.clear();
   seeds=[];safeCarrot=0;plantLimit=20;waterLimit=1;
   field.querySelectorAll(".plant").forEach(p=>p.remove());
   msg.textContent="ğŸ”„ éŠæˆ²é‡æ–°é–‹å§‹ï¼";
   updateUI();
 }
});

// === æ›´æ–°ç•«é¢ ===
function updateUI(){
 const wild=seeds.filter(p=>p.stage!=="grown").length;
 const grown=seeds.filter(p=>p.stage==="grown").length;
 const total=wild+grown+safeCarrot;
 const rate=total?Math.round((safeCarrot/total)*100):0;
 wildEl.textContent="é‡ç”Ÿè˜¿è””ğŸ¥•ï¼š"+wild;
 safeEl.textContent="å®‰å…¨è˜¿è””ğŸŒŸï¼š"+safeCarrot;
 totalEl.textContent="ç¸½æ”¶æˆï¼š"+total+" æ ¹";
 rateEl.textContent="VIP å®‰å…¨ç‡ï¼š"+rate+"%";
 bar.style.width=Math.min(rate,100)+"%";
 plantBtn.textContent=`ç¨®è˜¿è”” ğŸŒ° (${plantLimit}/20)`;
 waterBtn.textContent=`æ·‹æ°´ ğŸ’§ (${waterLimit}/1)`;
 plantBtn.disabled=plantLimit<=0;
 waterBtn.disabled=waterLimit<=0;
 updateTimer();
}

// === å€’æ•¸æ™‚é–“é¡¯ç¤º ===
function updateTimer(){
 const now=Date.now();
 const pending=seeds.filter(p=>p.stage!=="grown");
 if(pending.length===0){timerText.textContent="";return;}
 let minLeft=null;
 pending.forEach(p=>{
   const target=p.stage==="seed"?5400:10800;
   const left=target-(now-p.start)/1000;
   if(left>0&&(minLeft==null||left<minLeft))minLeft=left;
 });
 if(minLeft!=null){timerText.textContent="â³ ä¸‹ä¸€éšæ®µå‰©é¤˜ "+Math.ceil(minLeft/60)+" åˆ†é˜";}
 else timerText.textContent="";
}

// === å‹•ç‰©å‹•ç•« ===
setInterval(()=>{
 const r=Math.random();
 const rabbit=document.getElementById("rabbit");
 const cat=document.getElementById("cat");
 if(r<0.1){rabbit.classList.add("run");setTimeout(()=>rabbit.classList.remove("run"),4000);}
 else if(r<0.2){cat.classList.add("run");setTimeout(()=>cat.classList.remove("run"),4000);}
},60000);

updateUI();
});
</script>
</body>
</html>